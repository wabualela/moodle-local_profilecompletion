{"version":3,"file":"prompt.min.js","sources":["../src/prompt.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Profile completion inline notification handler.\n *\n * The PHP hook renders the notification element hidden at the top of <body>.\n * This module moves it into the page content area and shows it,\n * matching the position of the theme-checkplugins block.\n *\n * @module     local_profilecompletion/prompt\n * @copyright  2026 Moddaker\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\n\n/** Selector for the hidden notification element rendered by the hook. */\nconst NOTIFICATION_SELECTOR = '[data-region=\"local-profilecompletion-notification\"]';\n\n/**\n * Candidate selectors for the content-area insertion point, tried in order.\n * - #page-content   — mb2nl theme main content wrapper\n * - #region-main    — Moodle standard region\n * - [data-region=\"main-content\"] — Boost / other themes\n */\nconst CONTENT_SELECTORS = [\n    '#page-content',\n    '#region-main',\n    '[data-region=\"main-content\"]',\n];\n\n/**\n * Find the best available content-area container.\n *\n * @returns {Element|null}\n */\nconst findContentArea = () => {\n    for (const selector of CONTENT_SELECTORS) {\n        const el = document.querySelector(selector);\n        if (el) {\n            return el;\n        }\n    }\n    return null;\n};\n\n/**\n * Open the profile-completion modal form.\n *\n * @param {Object}       config\n * @param {HTMLElement|null} returnFocus\n */\nconst openModal = (config, returnFocus = null) => {\n    const modalForm = new ModalForm({\n        modalConfig: {\n            title: config.modaltitle,\n            large: true,\n            isVerticallyCentered: true,\n        },\n        formClass: config.formclass,\n        saveButtonText: config.savebuttontext,\n        returnFocus: returnFocus || document.body,\n    });\n\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n        window.location.reload();\n    });\n\n    modalForm.show();\n};\n\n/**\n * Initialise the profile-completion inline notification.\n *\n * Moves the hidden notification element into the page content area,\n * makes it visible, and wires the \"fill missing fields\" button to the modal.\n *\n * @param {Object} config\n * @param {string} config.modaltitle\n * @param {string} config.savebuttontext\n * @param {string} config.formclass\n */\nexport const init = (config) => {\n    if (!config) {\n        return;\n    }\n\n    const notificationEl = document.querySelector(NOTIFICATION_SELECTOR);\n    if (!notificationEl) {\n        return;\n    }\n\n    // Move the notification from the top of <body> into the content area.\n    const contentArea = findContentArea();\n    if (contentArea) {\n        contentArea.prepend(notificationEl);\n    }\n\n    // Show the notification now that it is in the right place.\n    notificationEl.style.display = '';\n\n    // Handle the \"fill missing fields\" button click.\n    notificationEl.addEventListener('click', (e) => {\n        const trigger = e.target.closest('.local-profilecompletion-open');\n        if (!trigger) {\n            return;\n        }\n        e.preventDefault();\n        openModal(config, trigger);\n    });\n};\n"],"names":["CONTENT_SELECTORS","config","notificationEl","document","querySelector","contentArea","selector","el","findContentArea","prepend","style","display","addEventListener","e","trigger","target","closest","preventDefault","returnFocus","modalForm","ModalForm","modalConfig","title","modaltitle","large","isVerticallyCentered","formClass","formclass","saveButtonText","savebuttontext","body","events","FORM_SUBMITTED","window","location","reload","show","openModal"],"mappings":";;;;;;;;;;;sJAsCMA,kBAAoB,CACtB,gBACA,eACA,8CAsDiBC,aACZA,oBAICC,eAAiBC,SAASC,cAtEN,4DAuErBF,4BAKCG,YAzDc,UACf,MAAMC,YAAYN,kBAAmB,OAChCO,GAAKJ,SAASC,cAAcE,aAC9BC,UACOA,UAGR,MAkDaC,GAChBH,aACAA,YAAYI,QAAQP,gBAIxBA,eAAeQ,MAAMC,QAAU,GAG/BT,eAAeU,iBAAiB,SAAUC,UAChCC,QAAUD,EAAEE,OAAOC,QAAQ,iCAC5BF,UAGLD,EAAEI,iBAvDQ,SAAChB,YAAQiB,mEAAc,WAC/BC,UAAY,IAAIC,mBAAU,CAC5BC,YAAa,CACTC,MAAOrB,OAAOsB,WACdC,OAAO,EACPC,sBAAsB,GAE1BC,UAAWzB,OAAO0B,UAClBC,eAAgB3B,OAAO4B,eACvBX,YAAaA,aAAef,SAAS2B,OAGzCX,UAAUP,iBAAiBO,UAAUY,OAAOC,gBAAgB,KACxDC,OAAOC,SAASC,YAGpBhB,UAAUiB,OAwCNC,CAAUpC,OAAQa"}